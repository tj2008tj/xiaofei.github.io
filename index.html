<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>小菲新年快乐新年快乐</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Comic Sans MS", cursive, sans-serif;
        }
        body {
            background-color: #fdf2f8;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }
        .hidden {
            display: none !important;
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #ffb6c1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-track {
            background: #fef7ff;
        }
        /* 画面1：密码弹窗 */
        .page1 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #fcf1f7 0%, #fef7ff 100%);
            z-index: 999;
        }
        .password-box {
            background: #fff;
            padding: 35px 25px;
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(255, 179, 204, 0.6);
            border: 3px solid #ffb6c1;
            text-align: center;
            width: 85%;
            max-width: 320px;
        }
        .password-box h1 {
            color: #ff69b4;
            font-size: 28px;
            margin-bottom: 25px;
            text-shadow: 2px 2px 3px rgba(255, 179, 204, 0.4);
        }
        .password-input {
            padding: 10px 12px;
            width: 200px;
            border: 2px solid #ffd1dc;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            outline: none;
            text-align: center;
            background: #fef7ff;
        }
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .confirm-btn {
            background: #ff69b4;
            color: #fff;
        }
        .confirm-btn:active {
            background: #ff1493;
            transform: scale(0.95);
        }
        .cancel-btn {
            background: #f0f0f0;
            color: #666;
        }
        .cancel-btn:active {
            background: #e0e0e0;
            transform: scale(0.95);
        }
        /* 画面2：立体信件 */
        .page2 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #fef7ff 0%, #fcf1f7 100%);
            overflow: hidden;
            z-index: 998;
        }
        .particle {
            position: absolute;
            background: rgba(255, 179, 204, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }
        .letter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -150%) scale(0.5) rotate(2deg);
            width: 280px;
            height: 400px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 1px solid #f0e6eb;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            animation: letterFly 1.5s ease forwards;
            background-image: linear-gradient(120deg, #fffbfc 0%, #ffffff 100%);
            z-index: 2;
        }
        .letter::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 2px;
            background: #f0e6eb;
        }
        .letter::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 1px;
            background: #f0e6eb;
            opacity: 0.6;
        }
        .letter-seal {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 25px;
            height: 25px;
            background: #ff69b4;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(255, 105, 180, 0.4);
        }
        .letter-title {
            color: #ff85a2;
            font-size: 20px;
            font-weight: 400;
            letter-spacing: 3px;
            text-shadow: 1px 1px 2px rgba(255, 179, 204, 0.2);
            z-index: 3;
        }
        @keyframes letterFly {
            0% { transform: translate(-50%, -150%) scale(0.5) rotate(2deg); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }
        /* 画面3：Kitty气泡 + 音乐 */
        .page3 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #fcf1f7 0%, #fdf2f8 100%);
            overflow: hidden;
            z-index: 997;
        }
        .kitty-bubble {
            position: absolute;
            padding: 10px 18px;
            border-radius: 18px;
            background: linear-gradient(45deg, #ffc0cb, #ffb6c1, #ffd1dc);
            color: #fff;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(255, 179, 204, 0.3);
            border: 2px solid #fff;
            opacity: 0;
            transform: scale(0.8);
            animation: bubblePop 0.5s ease forwards;
            z-index: 5;
        }
        @keyframes bubblePop {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .year2026 {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 40px;
            color: #fff;
            background: #ff69b4;
            padding: 30px 60px;
            border-radius: 15px;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(0,0,0,0.2);
            box-shadow: 0 0 40px rgba(255, 105, 180, 0.7);
            opacity: 0;
            animation: yearGrow 15s linear forwards;
            z-index: 10;
        }
        @keyframes yearGrow {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(120); opacity: 0; }
        }
        /* 画面4：信件 + 音乐 */
        .page4 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #fdf2f8 0%, #fef7ff 100%);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 0;
            z-index: 996;
        }
        .scroll-particle {
            position: absolute;
            background: rgba(255, 179, 204, 0.5);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }
        .letter-open {
            max-width: 700px;
            margin: 0 auto;
            background: #fff;
            padding: 30px 20px;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(255, 179, 204, 0.2);
            border: 2px solid #ffd1dc;
            position: relative;
            z-index: 2;
        }
        .letter-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .letter-header h1 {
            color: #ff69b4;
            font-size: 24px;
            margin-bottom: 8px;
        }
        .letter-header h2 {
            color: #ff85a2;
            font-size: 18px;
            font-weight: 500;
        }
        .letter-content {
            line-height: 1.9;
            color: #333;
            font-size: 15px;
        }
        .letter-content p {
            margin-bottom: 12px;
            text-indent: 2em;
        }
        .letter-img {
            display: block;
            max-width: 100%;
            border-radius: 10px;
            margin: 25px auto;
            box-shadow: 0 0 15px rgba(255, 179, 204, 0.15);
        }
        .end-btn {
            display: block;
            margin: 30px auto;
            padding: 12px 35px;
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
            transition: all 0.3s ease;
        }
        .end-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.4);
        }
        /* 画面5：烟花 + 音乐 */
        .page5 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #0f0f23;
            overflow: hidden;
            z-index: 999;
        }
        .firework {
            position: absolute;
            pointer-events: none;
            z-index: 2;
        }
        .meteor {
            position: absolute;
            background: linear-gradient(90deg, #fff, rgba(255, 255, 255, 0));
            width: 80px;
            height: 2px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }
        .box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            perspective: 600px;
            z-index: 5;
            opacity: 0;
            animation: boxAppear 0.5s ease 3s forwards;
            cursor: pointer;
        }
        .box-inner {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: boxRotate 2s ease 3s forwards, boxClose 1s ease 5s forwards;
        }
        .box-face {
            position: absolute;
            width: 180px;
            height: 180px;
            background: linear-gradient(45deg, #ff69b4, #ff85a2);
            border: 2px solid #fff;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.5);
        }
        .box-front { transform: rotateY(0deg) translateZ(90px); }
        .box-back { transform: rotateY(180deg) translateZ(90px); }
        .box-left { transform: rotateY(-90deg) translateZ(90px); }
        .box-right { transform: rotateY(90deg) translateZ(90px); }
        .box-top { transform: rotateX(90deg) translateZ(90px); }
        .box-bottom { transform: rotateX(-90deg) translateZ(90px); }
        .box-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            text-shadow: 0 0 8px #fff;
            opacity: 0;
            animation: textGlow 1s ease 6s infinite alternate;
            z-index: 6;
        }
        @keyframes boxAppear { to { opacity: 1; } }
        @keyframes boxRotate {
            0% { transform: rotateY(0) rotateX(0); }
            100% { transform: rotateY(360deg) rotateX(180deg); }
        }
        @keyframes boxClose { to { transform: rotateY(0) rotateX(0); } }
        @keyframes textGlow {
            from { text-shadow: 0 0 8px #fff; }
            to { text-shadow: 0 0 15px #ff69b4, 0 0 25px #ff1493; }
        }
        .gift-particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 3;
        }
        /* 红包信件样式 */
        .redpacket-letter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #e63946, #d62828);
            color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid #fff;
            text-align: center;
            font-size: 24px;
            z-index: 20;
            max-width: 80%;
            display: none;
        }
    </style>
</head>
<body>
    <!-- 画面1：密码弹窗 -->
    <div class="page1" id="page1">
        <div class="password-box">
            <h1>赵雨菲</h1>
            <input type="password" class="password-input" id="passwordInput" placeholder="请输入密码">
            <div class="btn-group">
                <button class="btn confirm-btn" onclick="checkPassword()">确定</button>
                <button class="btn cancel-btn" onclick="clearPassword()">取消</button>
            </div>
        </div>
    </div>

    <!-- 画面2：立体信件 -->
    <div class="page2 hidden" id="page2">
        <div class="letter" id="letter" onclick="goToPage3()">
            <div class="letter-seal"></div>
            <div class="letter-title">新年快乐</div>
        </div>
    </div>

    <!-- 画面3：Kitty气泡 + 恭喜你发财音乐 -->
    <div class="page3 hidden" id="page3">
        <iframe 
            frameborder="no" 
            border="0" 
            marginwidth="0" 
            marginheight="0" 
            width="100%" 
            max-width="330" 
            height="86" 
            src="//music.163.com/outchain/player?type=2&id=2752170292&auto=1&height=66" 
            style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 15;"
            id="music1"
        ></iframe>
    </div>

    <!-- 画面4：打开的信件 + 不说音乐 -->
    <div class="page4 hidden" id="page4">
        <div class="letter-open">
            <div class="letter-header">
                <h1>回顾我们的上一年</h1>
                <h2>To：小菲</h2>
                <h2>回顾我们的2025年</h2>
            </div>
            <iframe 
                frameborder="no" 
                border="0" 
                marginwidth="0" 
                marginheight="0" 
                width="100%" 
                max-width="330" 
                height="86" 
                src="//music.163.com/outchain/player?type=2&id=2689723913&auto=1&height=66" 
                style="display: block; margin: 0 auto 20px; z-index: 15;"
                id="music2"
            ></iframe>
            <div class="letter-content">
                <p>谢谢哥哥愿意花一个红包打开这封信。</p>
                <p>咳咳咳咳咳咳，辞旧迎新，拜年啦，新的一年啦，今年是马年，祝哥哥新年快乐，心想事成，马年的话，跟马一样跑得快，飞得高，走得远。马好像不会飞吧，那就祝哥哥能达到自己想达到的地步，考试取得好成绩，自己希望得到事，都能有个好的成果。今年要天天开心哦，仆仆依旧会陪着哥哥。Ok，现在我就来回顾一下</p>
                <p>2025年10月3日那天是我们的缘分的开始，国庆假期太无聊了，于是就看到了“一字萌”发的抖音文案，从此命运的齿轮开始转动。</p>
                <p>我该叫你什么？——哥哥，我是哥哥的仆仆，最好的！嘿嘿嘿！</p>
                <p>这一年跟哥哥玩的特别特别开心，特别特别特别开心，因为哥哥在家无聊，我们两个都很无聊，所以我们两个都玩的很开心，最开始我们很抽象，哥哥也愿意搭理我，我们两个都玩的很好，很开心，我也喜欢和哥哥玩。我给哥哥发消息，哥哥每一句都会回，哥哥还会给我报备，虽说说那个文案要求我给哥哥报备，我也每时每刻在给哥哥报备。</p>
                <p>小菲呢是一个特别有趣的人，跟小菲在一起玩，我感觉特别温馨，有时候突然就感觉到特别幸福，有个人陪的感觉特别好，放假了就能开开心心一起玩。</p>
                <p>话说我有个问题我记得是哥哥让我叫哥哥的，有一次我说我不叫你哥哥了，哥哥还不准，但上次哥哥说让我不叫了，我不知道，我最讨厌的就是我们关系之中有其他人来影响了。哥哥明明最开始是喜欢我叫的。</p>
                <p>后面就一直跟哥哥玩，哥哥给我发钱，买东西逗我开心。然后我给哥哥买了特别辣的，哥哥整蛊同学，给哥哥买了特别酸的给哥哥整蛊同学。本意是想解决哥哥的晕车状况的——然后我们还一起玩游戏，玩王者跟哥哥一起打到了钻石的位置，但是哥哥好像总是被人说，然后我安慰哥，但是哥哥突然间就不喜欢玩游戏了。那我们就玩蛋仔，我们蛋仔也玩了很多很多的有趣的关卡和模式。我们一起经历了很多有趣的事。我就越来越喜欢哥哥了，爱上哥哥了。</p>
                <p>直到有一次哥哥问我们之间的关系是什么样的，我是想和哥哥成为恋人的，哥哥当时给不出决定，但是给了一个有8成。我当时特别开心，但是后面我们还是不能一起走向恋人的，有时候会想，要是哥哥愿意跟我走向恋人该多好呀，想跟哥哥一辈子都待在一起。哥哥真的很真诚，而且很纯爱，有时候会想这么好的女孩，要是能真正爱上我肯定会爱死她的。还有时候会怕哥哥以后会受到伤害什么的。后面呢，经历了一个转折，我尊重哥哥的选择，但是这次转折并没有把我们的关系打入冷淡，我还是特别喜欢和哥哥玩的。况且哥哥现在还没有找到自己喜欢的人的时候。我们还是一个特别特别好的，好的，好的好朋友。友谊长存！</p>
                <img src="https://i.ibb.co/ccrB0RvJ/1767183319.jpg" alt="蛋仔游戏截图" class="letter-img">
                <p>这是上次玩蛋仔，然后99个选择题中，然后我看到有一些就是记录了哥哥喜欢的，一些低糖奶茶，喜欢吃什么东西，喜欢的方式什么的。虽说有时候我有点笨笨的，有可能在细节中有一点照顾不到，但是明摆着的答案，我怎么可能不抄呢，嘿嘿嘿！</p>
                <p>呃，写到一半和哥哥聊天去了，哈哈哈哈哈</p>
                <p>那就聊了这吧，我要去和哥哥聊天，这一年我希望我们还一直的玩下去，友谊长存，开开心心的玩下去，新年快乐！</p>
            </div>
            <button class="end-btn" id="endBtn" onclick="goToPage5()">结束信件</button>
        </div>
    </div>

    <!-- 画面5：烟花 + 烟花声音乐 -->
    <div class="page5 hidden" id="page5">
        <iframe 
            frameborder="no" 
            border="0" 
            marginwidth="0" 
            marginheight="0" 
            width="298" 
            height="52" 
            src="//music.163.com/outchain/player?type=2&id=29728279&auto=1&height=32" 
            style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 10;"
            id="music3"
        ></iframe>
        <div class="box" onclick="showRedpacketLetter()">
            <div class="box-inner">
                <div class="box-face box-front"></div>
                <div class="box-face box-back"></div>
                <div class="box-face box-left"></div>
                <div class="box-face box-right"></div>
                <div class="box-face box-top"></div>
                <div class="box-face box-bottom"></div>
            </div>
            <div class="box-text">点开礼物</div>
        </div>
        <!-- 红包信件 -->
        <div class="redpacket-letter" id="redpacketLetter">
            快去找小沐领取新年红包
        </div>
    </div>

    <script>
        const page1 = document.getElementById('page1');
        const page2 = document.getElementById('page2');
        const page3 = document.getElementById('page3');
        const page4 = document.getElementById('page4');
        const page5 = document.getElementById('page5');
        const passwordInput = document.getElementById('passwordInput');
        const letter = document.getElementById('letter');
        const redpacketLetter = document.getElementById('redpacketLetter');
        const music1 = document.getElementById('music1');
        const music2 = document.getElementById('music2');
        const music3 = document.getElementById('music3');

        // 解决音乐自动播放问题 - 监听用户交互
        document.addEventListener('click', function enableAudio() {
            // 尝试播放音乐
            const tryPlay = (iframe) => {
                try {
                    iframe.contentWindow.postMessage('{"method":"play"}', '*');
                } catch (e) {
                    console.log('播放失败:', e);
                }
            };
            
            tryPlay(music1);
            tryPlay(music2);
            tryPlay(music3);
            
            // 只需要触发一次
            document.removeEventListener('click', enableAudio);
        }, { once: true });

        // 密码验证
        function checkPassword() {
            const password = passwordInput.value.trim();
            if (password === '1207') {
                page1.classList.add('hidden');
                page2.classList.remove('hidden');
                createParticles(page2, 80);
            } else {
                alert('密码错误，请重新输入~');
                passwordInput.value = '';
            }
        }

        // 清空密码
        function clearPassword() {
            passwordInput.value = '';
        }

        // 生成粒子
        function createParticles(container, count) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const size = Math.random() * 6 + 1;
                const x = Math.random() * container.clientWidth;
                const y = Math.random() * container.clientHeight;
                const duration = Math.random() * 8 + 4;
                const moveX = Math.random() * 15 - 7;
                const moveY = Math.random() * 15 - 7;

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.animation = `particleFloat ${duration}s linear infinite`;

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes particleFloat {
                        0% { transform: translateY(0) translateX(0); }
                        25% { transform: translateY(${moveY}px) translateX(${moveX}px); }
                        50% { transform: translateY(${moveY * 2}px) translateX(0); }
                        75% { transform: translateY(${moveY}px) translateX(${-moveX}px); }
                        100% { transform: translateY(0) translateX(0); }
                    }
                `;
                document.head.appendChild(style);
                container.appendChild(particle);
            }
        }

        // 跳转画面3
        function goToPage3() {
            page2.classList.add('hidden');
            page3.classList.remove('hidden');
            // 尝试播放第一首音乐
            try {
                music1.contentWindow.postMessage('{"method":"play"}', '*');
            } catch (e) {
                console.log('播放音乐1失败:', e);
            }
            createBubbles();
        }

        // 生成Kitty气泡
        function createBubbles() {
            const bubbleTexts = [
                "赵雨菲新年快乐", "小菲马年大吉", "雨菲天天开心", "赵雨菲心想事成", "小菲平安喜乐",
                "雨菲前程似锦", "赵雨菲福气满满", "小菲好运连连", "雨菲笑口常开", "赵雨菲甜甜蜜蜜",
                "小菲万事顺意", "雨菲吉祥如意", "赵雨菲无忧无虑", "小菲活力满满", "雨菲幸福安康",
                "赵雨菲岁岁平安", "小菲马到成功", "雨菲称心如意", "赵雨菲快乐加倍", "小菲惊喜不断",
                "雨菲温暖常存", "赵雨菲幸运爆棚", "小菲趣味多多", "雨菲一切都好", "赵雨菲友谊长存",
                "小菲学业进步", "雨菲闪闪发光", "赵雨菲顺心顺意", "小菲健康成长", "雨菲美好相伴"
            ];

            const getRandomPos = () => {
                const col = Math.floor(Math.random() * 5);
                const row = Math.floor(Math.random() * 7);
                const x = col * (window.innerWidth / 5) + Math.random() * 30 + 15;
                const y = row * (window.innerHeight / 7) + Math.random() * 25 + 15;
                return { x, y };
            };

            bubbleTexts.forEach((text, index) => {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'kitty-bubble';
                    bubble.textContent = text;
                    const { x, y } = getRandomPos();
                    bubble.style.left = `${x}px`;
                    bubble.style.top = `${y}px`;
                    page3.appendChild(bubble);

                    if (index === bubbleTexts.length - 1) {
                        setTimeout(() => {
                            const yearText = document.createElement('div');
                            yearText.className = 'year2026';
                            yearText.textContent = '我们的2026年';
                            page3.appendChild(yearText);
                            setTimeout(() => {
                                // 停止第一首音乐
                                try {
                                    music1.contentWindow.postMessage('{"method":"pause"}', '*');
                                } catch (e) {
                                    console.log('暂停音乐1失败:', e);
                                }
                                page3.classList.add('hidden');
                                page4.classList.remove('hidden');
                                // 播放第二首音乐
                                try {
                                    music2.contentWindow.postMessage('{"method":"play"}', '*');
                                } catch (e) {
                                    console.log('播放音乐2失败:', e);
                                }
                                initAutoScroll();
                                initScrollParticles();
                            }, 15000); // 配合放慢的动画时间
                        }, 800);
                    }
                }, index * 300);
            });
        }

        // 自动滚动
        function initAutoScroll() {
            const page4 = document.getElementById('page4');
            let scrollSpeed = 0.2;
            let autoScroll = true;

            const scrollInterval = setInterval(() => {
                if (autoScroll && page4.scrollTop < page4.scrollHeight - page4.clientHeight - 150) {
                    page4.scrollTop += scrollSpeed;
                } else {
                    clearInterval(scrollInterval);
                }
            }, 50);

            page4.addEventListener('touchmove', () => {
                autoScroll = false;
                clearInterval(scrollInterval);
            });
        }

        // 滑动粒子
        function initScrollParticles() {
            const page4 = document.getElementById('page4');
            page4.addEventListener('scroll', () => {
                if (Math.random() > 0.8) {
                    const particle = document.createElement('div');
                    particle.className = 'scroll-particle';
                    const size = Math.random() * 5 + 1;
                    const x = Math.random() * page4.clientWidth;
                    const y = page4.scrollTop + page4.clientHeight;
                    const duration = Math.random() * 5 + 2;

                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    particle.style.animation = `scrollFloat ${duration}s linear forwards`;

                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes scrollFloat {
                            0% { transform: translateY(0); opacity: 1; }
                            100% { transform: translateY(-80px); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    page4.appendChild(particle);
                    setTimeout(() => particle.remove(), duration * 1000);
                }
            });
        }

        // 跳转画面5
        function goToPage5() {
            page4.classList.add('hidden');
            page5.classList.remove('hidden');
            // 停止第二首音乐
            try {
                music2.contentWindow.postMessage('{"method":"pause"}', '*');
            } catch (e) {
                console.log('暂停音乐2失败:', e);
            }
            // 播放第三首音乐（烟花声）
            try {
                music3.contentWindow.postMessage('{"method":"play"}', '*');
            } catch (e) {
                console.log('播放音乐3失败:', e);
            }
            createFireworks();
            createMeteors();
            createGiftParticles(page5, 150);
        }

        // 显示红包信件
        function showRedpacketLetter() {
            redpacketLetter.style.display = 'block';
            // 添加显示动画
            redpacketLetter.style.animation = 'bubblePop 0.5s ease forwards';
        }

        // 烟花
        function createFireworks() {
            const page5 = document.getElementById('page5');
            const fireworkCount = 20;
            const colors = ['#ff69b4', '#ffb6c1', '#ffffff', '#ff4500', '#ffff00', '#00ff00', '#00ffff', '#9932cc', '#ff00ff', '#1e90ff'];

            for (let i = 0; i < fireworkCount; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    const x = Math.random() * page5.clientWidth;
                    const y = Math.random() * page5.clientHeight;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const size = Math.random() * 120 + 40;

                    firework.style.left = `${x}px`;
                    firework.style.top = `${y}px`;
                    firework.style.width = `${size}px`;
                    firework.style.height = `${size}px`;
                    firework.style.border = `2px solid ${color}`;
                    firework.style.borderRadius = '50%';
                    firework.style.animation = `fireworkPop 2s ease forwards`;

                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes fireworkPop {
                            0% { transform: scale(0); opacity: 1; }
                            50% { transform: scale(1); opacity: 1; box-shadow: 0 0 25px ${color}; }
                            100% { transform: scale(0); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    page5.appendChild(firework);
                    setTimeout(() => firework.remove(), 2000);
                }, i * 400);
            }
        }

        // 流星雨
        function createMeteors() {
            const page5 = document.getElementById('page5');
            const meteorCount = 40;

            for (let i = 0; i < meteorCount; i++) {
                setTimeout(() => {
                    const meteor = document.createElement('div');
                    meteor.className = 'meteor';
                    const x = Math.random() * page5.clientWidth;
                    const y = Math.random() * page5.clientHeight;
                    const rotate = Math.random() * 30 + 60;

                    meteor.style.left = `${x}px`;
                    meteor.style.top = `${y}px`;
                    meteor.style.transform = `rotate(${rotate}deg)`;
                    meteor.style.animation = `meteorFly 3s linear forwards`;

                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes meteorFly {
                            0% { transform: rotate(${rotate}deg) translateX(0); opacity: 1; }
                            100% { transform: rotate(${rotate}deg) translateX(-180px); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    page5.appendChild(meteor);
                    setTimeout(() => meteor.remove(), 3000);
                }, i * 200);
            }
        }

        // 礼物粒子
        function createGiftParticles(container, count) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'gift-particle';
                const size = Math.random() * 5 + 1;
                const x = Math.random() * container.clientWidth;
                const y = Math.random() * container.clientHeight;
                const duration = Math.random() * 7 + 3;

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.animation = `giftFloat ${duration}s linear infinite`;

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes giftFloat {
                        0% { transform: translateY(0) translateX(0); opacity: 1; }
                        25% { transform: translateY(-12px) translateX(8px); opacity: 0.8; }
                        50% { transform: translateY(-25px) translateX(0); opacity: 1; }
                        75% { transform: translateY(-12px) translateX(-8px); opacity: 0.8; }
                        100% { transform: translateY(0) translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                container.appendChild(particle);
            }
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>小菲新年快乐</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Comic Sans MS", cursive, sans-serif;
        }
        body {
            background-color: #fdf2f8;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation; /* 微信触摸兼容 */
        }
        /* 通用隐藏类 */
        .hidden {
            display: none !important;
        }
        /* 滚动条美化（微信兼容） */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #ffb6c1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-track {
            background: #fef7ff;
        }
        /* ========== 画面1：密码弹窗（核心修复） ========== */
        .page1 {
            position: fixed; /* 微信优先fixed布局 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #fcf1f7 0%, #fef7ff 100%);
            z-index: 999; /* 确保在最上层 */
        }
        .password-box {
            background: #fff;
            padding: 35px 25px;
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(255, 179, 204, 0.6);
            border: 3px solid #ffb6c1;
            text-align: center;
            width: 85%;
            max-width: 320px;
        }
        .password-box h1 {
            color: #ff69b4;
            font-size: 28px;
            margin-bottom: 25px;
            text-shadow: 2px 2px 3px rgba(255, 179, 204, 0.4);
        }
        .password-input {
            padding: 10px 12px;
            width: 200px;
            border: 2px solid #ffd1dc;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            outline: none;
            text-align: center;
            background: #fef7ff;
        }
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .confirm-btn {
            background: #ff69b4;
            color: #fff;
        }
        .confirm-btn:active {
            background: #ff1493;
            transform: scale(0.95);
        }
        .cancel-btn {
            background: #f0f0f0;
            color: #666;
        }
        .cancel-btn:active {
            background: #e0e0e0;
            transform: scale(0.95);
        }
        /* ========== 画面2：立体信件 + 粒子 ========== */
        .page2 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #fef7ff 0%, #fcf1f7 100%);
            overflow: hidden;
            z-index: 998;
        }
        .particle {
            position: absolute;
            background: rgba(255, 179, 204, 0.6);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }
        .letter {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -150%) scale(0.5) rotate(2deg);
            width: 280px;
            height: 400px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 1px solid #f0e6eb;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            animation: letterFly 1.5s ease forwards;
            background-image: linear-gradient(120deg, #fffbfc 0%, #ffffff 100%);
            z-index: 2;
        }
        .letter::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 2px;
            background: #f0e6eb;
        }
        .letter::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 1px;
            background: #f0e6eb;
            opacity: 0.6;
        }
        .letter-seal {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 25px;
            height: 25px;
            background: #ff69b4;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(255, 105, 180, 0.4);
        }
        .letter-title {
            color: #ff85a2;
            font-size: 20px;
            font-weight: 400;
            letter-spacing: 3px;
            text-shadow: 1px 1px 2px rgba(255, 179, 204, 0.2);
            z-index: 3;
        }
        @keyframes letterFly {
            0% { transform: translate(-50%, -150%) scale(0.5) rotate(2deg); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }
        /* ========== 画面3：Kitty气泡 + 2026覆盖 ========== */
        .page3 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #fcf1f7 0%, #fdf2f8 100%);
            overflow: hidden;
            z-index: 997;
        }
        .kitty-bubble {
            position: absolute;
            padding: 10px 18px;
            border-radius: 18px;
            background: linear-gradient(45deg, #ffc0cb, #ffb6c1, #ffd1dc);
            color: #fff;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(255, 179, 204, 0.3);
            border: 2px solid #fff;
            opacity: 0;
            transform: scale(0.8);
            animation: bubblePop 0.5s ease forwards;
            z-index: 5;
        }
        @keyframes bubblePop {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .year2026 {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 40px;
            color: #fff;
            background: #ff69b4;
            padding: 30px 60px;
            border-radius: 15px;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(0,0,0,0.2);
            box-shadow: 0 0 40px rgba(255, 105, 180, 0.7);
            opacity: 0;
            animation: yearGrow 10s linear forwards; /* 微信适配：放慢速度 */
            z-index: 10;
        }
        @keyframes yearGrow {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(120); opacity: 0; }
        }
        /* ========== 画面4：打开的信件 + 自动滚动 ========== */
        .page4 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #fdf2f8 0%, #fef7ff 100%);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 0;
            z-index: 996;
        }
        .scroll-particle {
            position: absolute;
            background: rgba(255, 179, 204, 0.5);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }
        .letter-open {
            max-width: 700px;
            margin: 0 auto;
            background: #fff;
            padding: 30px 20px;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(255, 179, 204, 0.2);
            border: 2px solid #ffd1dc;
            position: relative;
            z-index: 2;
        }
        .letter-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .letter-header h1 {
            color: #ff69b4;
            font-size: 24px;
            margin-bottom: 8px;
        }
        .letter-header h2 {
            color: #ff85a2;
            font-size: 18px;
            font-weight: 500;
        }
        .letter-content {
            line-height: 1.9;
            color: #333;
            font-size: 15px;
        }
        .letter-content p {
            margin-bottom: 12px;
            text-indent: 2em;
        }
        .letter-img {
            display: block;
            max-width: 100%;
            border-radius: 10px;
            margin: 25px auto;
            box-shadow: 0 0 15px rgba(255, 179, 204, 0.15);
        }
        .end-btn {
            display: block;
            margin: 30px auto;
            padding: 12px 35px;
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
            transition: all 0.3s ease;
        }
        .end-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.4);
        }
        /* ========== 画面5：烟花流星雨 + 惊喜盒子 ========== */
        .page5 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #0f0f23;
            overflow: hidden;
            z-index: 999;
        }
        .firework {
            position: absolute;
            pointer-events: none;
            z-index: 2;
        }
        .meteor {
            position: absolute;
            background: linear-gradient(90deg, #fff, rgba(255, 255, 255, 0));
            width: 80px;
            height: 2px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
        }
        .box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            perspective: 600px;
            z-index: 5;
            opacity: 0;
            animation: boxAppear 0.5s ease 3s forwards;
        }
        .box-inner {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: boxRotate 2s ease 3s forwards, boxClose 1s ease 5s forwards;
        }
        .box-face {
            position: absolute;
            width: 180px;
            height: 180px;
            background: linear-gradient(45deg, #ff69b4, #ff85a2);
            border: 2px solid #fff;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.5);
        }
        .box-front { transform: rotateY(0deg) translateZ(90px); }
        .box-back { transform: rotateY(180deg) translateZ(90px); }
        .box-left { transform: rotateY(-90deg) translateZ(90px); }
        .box-right { transform: rotateY(90deg) translateZ(90px); }
        .box-top { transform: rotateX(90deg) translateZ(90px); }
        .box-bottom { transform: rotateX(-90deg) translateZ(90px); }
        .box-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            text-shadow: 0 0 8px #fff;
            opacity: 0;
            animation: textGlow 1s ease 6s infinite alternate;
            z-index: 6;
        }
        @keyframes boxAppear { to { opacity: 1; } }
        @keyframes boxRotate {
            0% { transform: rotateY(0) rotateX(0); }
            100% { transform: rotateY(360deg) rotateX(180deg); }
        }
        @keyframes boxClose { to { transform: rotateY(0) rotateX(0); } }
        @keyframes textGlow {
            from { text-shadow: 0 0 8px #fff; }
            to { text-shadow: 0 0 15px #ff69b4, 0 0 25px #ff1493; }
        }
        .gift-particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 3;
        }
    </style>
</head>
<body>
    <!-- 音频资源：必须替换为 公网可访问链接（微信不支持本地文件） -->
    <audio id="music1" src="https://xxx.com/恭喜你发财.mp3" preload="none">
    <audio id="music2" src="https://xxx.com/不说-周公.mp3" preload="none"> 
    <audio id="fireworkSoun" src="https://xxx.com/烟花声.mp3" preload="none"> 

    <!-- 画面1：密码弹窗（默认显示） -->
    <div class="page1" id="page1">
        <div class="password-box">
            <h1>赵雨菲</h1>
            <input type="password" class="password-input" id="passwordInput" placeholder="请输入密码">
            <div class="btn-group">
                <button class="btn confirm-btn" onclick="checkPassword()">确定</button>
                <button class="btn cancel-btn" onclick="clearPassword()">取消</button>
            </div>
        </div>
    </div>

    <!-- 画面2：立体信件 -->
    <div class="page2 hidden" id="page2">
        <div class="letter" id="letter" onclick="playMusic1()">
            <div class="letter-seal"></div>
            <div class="letter-title">新年快乐</div>
        </div>
    </div>

    <!-- 画面3：Kitty气泡 + 2026覆盖 -->
    <div class="page3 hidden" id="page3"> 
<iframe 
        frameborder="no" 
        border="0" 
        marginwidth="0" 
        marginheight="0" 
        width="100%" 
        max-width="330" 
        height="86" 
        src="//music.163.com/outchain/player?type=2&id=3329668871&auto=1&height=66"
        style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 15;"
    ></iframe>
</div>

    <!-- 画面4：打开的信件 -->
    <div class="page4 hidden" id="page4">
        <div class="letter-open">
            <div class="letter-header">
                <h1>回顾我们的上一年</h1>
                <h2>To：小菲</h2>
                <h2>回顾我们的2025年</h2>
            </div>
      <iframe 
            frameborder="no" 
            border="0" 
            marginwidth="0" 
            marginheight="0" 
            width="100%" 
            max-width="330" 
            height="86" 
            src="//music.163.com/outchain/player?type=2&id=《不说》的网易云歌曲id&auto=0&height=66" 
            style="display: block; margin: 0 auto 20px; z-index: 15;"
        >
sss</iframe>

            <div class="letter-content">
                <p>谢谢哥哥愿意花一个红包打开这封信。</p>
                <p>咳咳咳咳咳咳，辞旧迎新，拜年啦，新的一年啦，今年是马年，祝哥哥新年快乐，心想事成，马年的话，跟马一样跑得快，飞得高，走得远。马好像不会飞吧，那就祝哥哥能达到自己想达到的地步，考试取得好成绩，自己希望得到事，都能有个好的成果。今年要天天开心哦，仆仆依旧会陪着哥哥。Ok，现在我就来回归一下</p>
                <p>2025年10月3日那天是我们的缘分的开始，国庆假期太无聊了，于是就看到了“一字萌”发的抖音文案，从此命运的齿轮开始转动。</p>
                <p>我该叫你什么？——哥哥，我是哥哥的仆仆，最好的！嘿嘿嘿！</p>
                <p>这一年跟哥哥玩的特别特别开心，特别特别特别开心，因为哥哥在家无聊，我们两个都很无聊，所以我们两个都玩的很开心，最开始我们很抽象，哥哥也愿意搭理我，我们两个都玩的很好，很开心，我也喜欢和哥哥玩。我给哥哥发消息，哥哥每一句都会回，哥哥还会给我报备，虽说说那个文案要求我给哥哥报备，我也每时每刻在给哥哥报备。</p>
                <p>小菲呢是一个特别有趣的人，跟小菲在一起玩，我感觉特别温馨，有时候突然就感觉到特别幸福，有个人陪的感觉特别好，放假了就能开开心心一起玩。</p>
                <p>话说我有个问题我记得是哥哥让我叫哥哥的，有一次我说我不叫你哥哥了，哥哥还不准，但上次哥哥说让我不叫了，我不知道，我最讨厌的就是我们关系之中有其他人来影响了。哥哥明明最开始是喜欢我叫的。</p>
                <p>后面就一直跟哥哥玩，哥哥给我发钱，买东西逗我开心。然后我给哥哥买了特别辣的，哥哥整蛊同学，给哥哥买了特别酸的给哥哥整蛊同学。本意是想解决哥哥的晕车状况的——然后我们还一起玩游戏，玩王者跟哥哥一起打到了钻石的位置，但是哥哥好像总是被人说，然后我安慰哥，但是哥哥突然间就不喜欢玩游戏了。那我们就玩蛋仔，我们蛋仔也玩了很多很多的有趣的关卡和模式。我们一起经历了很多有趣的事。我就越来越喜欢哥哥了，爱上哥哥了。</p>
                <p>直到有一次哥哥问我们之间的关系是什么样的，我是想和哥哥成为恋人的，哥哥当时给不出决定，但是给了一个有8成。我当时特别开心，但是后面我们还是不能一起走向恋人的，有时候会想，要是哥哥愿意跟我走向恋人该多好呀，想跟哥哥一辈子都待在一起。哥哥真的很真诚，而且很纯爱，有时候会想这么好的女孩，要是能真正爱上我肯定会爱死她的。还有时候会怕哥哥以后会受到伤害什么的。后面呢，经历了一个转折，我尊重哥哥的选择，但是这次转折并没有把我们的关系打入冷淡，我还是特别喜欢和哥哥玩的。况且哥哥现在还没有找到自己喜欢的人的时候。我们还是一个特别特别好的，好的，好的好朋友。友谊长存！</p>
                <!-- 图片：替换为 公网可访问链接（微信不支持本地图片） -->
                <img src="https://i.ibb.co/ccrB0RvJ/1767183319.jpg" alt="蛋仔游戏截图" class="letter-img">

                <p>这是上次玩蛋仔，然后99个选择题中，然后我看到有一些就是记录了哥哥喜欢的，一些低糖奶茶，喜欢吃什么东西，喜欢的方式什么的。虽说有时候我有点笨笨的，有可能在细节中有一点照顾不到，但是明摆着的答案，我怎么可能不抄呢，嘿嘿嘿！</p>
                <p>呃，写到一半和哥哥聊天去了，哈哈哈哈哈</p>
                <p>那就聊了这吧，我要去和哥哥聊天，这一年我希望我们还一直的玩下去，友谊长存，开开心心的玩下去，新年快乐！</p>
            </div>
            <button class="end-btn" id="endBtn" onclick="goToPage5()">结束信件</button>
        </div>
    </div>

    <!-- 画面5：烟花 + 惊喜盒子 -->
    <div class="page5 hidden" id="page5"></div>

    <script>
        // 元素获取（确保无拼写错误）
        const page1 = document.getElementById('page1');
        const page2 = document.getElementById('page2');
        const page3 = document.getElementById('page3');
        const page4 = document.getElementById('page4');
        const page5 = document.getElementById('page5');
        const passwordInput = document.getElementById('passwordInput');
        const letter = document.getElementById('letter');
        const music1 = document.getElementById('music1');
        const music2 = document.getElementById('music2');
        const fireworkSound = document.getElementById('fireworkSound');

        // 密码验证（核心修复：确保逻辑正常）
        function checkPassword() {
            const password = passwordInput.value.trim();
            if (password === '1207') {
                page1.classList.add('hidden');
                page2.classList.remove('hidden');
                createParticles(page2, 80); // 减少粒子数量，微信更流畅
            } else {
                alert('密码错误，请重新输入~');
                passwordInput.value = '';
            }
        }

        // 清空密码
        function clearPassword() {
            passwordInput.value = '';
        }

        // 生成粒子特效（微信性能优化）
        function createParticles(container, count) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                const size = Math.random() * 6 + 1;
                const x = Math.random() * container.clientWidth;
                const y = Math.random() * container.clientHeight;
                const duration = Math.random() * 8 + 4;
                const moveX = Math.random() * 15 - 7;
                const moveY = Math.random() * 15 - 7;

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.animation = `particleFloat ${duration}s linear infinite`;

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes particleFloat {
                        0% { transform: translateY(0) translateX(0); }
                        25% { transform: translateY(${moveY}px) translateX(${moveX}px); }
                        50% { transform: translateY(${moveY * 2}px) translateX(0); }
                        75% { transform: translateY(${moveY}px) translateX(${-moveX}px); }
                        100% { transform: translateY(0) translateX(0); }
                    }
                `;
                document.head.appendChild(style);
                container.appendChild(particle);
            }
        }

        // 播放音乐1 + 跳转画面3（微信兼容：用户交互后触发）
        function playMusic1() {
            music1.play().catch(err => {
                // 微信可能需要二次点击，给出提示
                alert('请点击屏幕任意位置继续播放音乐~');
                music1.play();
            });
            page2.classList.add('hidden');
            page3.classList.remove('hidden');
            createBubbles();
        }

        // 生成30个Kitty气泡（网格分布无遮挡）
        function createBubbles() {
            const bubbleTexts = [
                "赵雨菲新年快乐", "小菲马年大吉", "雨菲天天开心", "赵雨菲心想事成", "小菲平安喜乐",
                "雨菲前程似锦", "赵雨菲福气满满", "小菲好运连连", "雨菲笑口常开", "赵雨菲甜甜蜜蜜",
                "小菲万事顺意", "雨菲吉祥如意", "赵雨菲无忧无虑", "小菲活力满满", "雨菲幸福安康",
                "赵雨菲岁岁平安", "小菲马到成功", "雨菲称心如意", "赵雨菲快乐加倍", "小菲惊喜不断",
                "雨菲温暖常存", "赵雨菲幸运爆棚", "小菲趣味多多", "雨菲一切都好", "赵雨菲友谊长存",
                "小菲学业进步", "雨菲闪闪发光", "赵雨菲顺心顺意", "小菲健康成长", "雨菲美好相伴"
            ];

            const getRandomPos = () => {
                const col = Math.floor(Math.random() * 5); // 减少列数，避免遮挡
                const row = Math.floor(Math.random() * 7);
                const x = col * (window.innerWidth / 5) + Math.random() * 30 + 15;
                const y = row * (window.innerHeight / 7) + Math.random() * 25 + 15;
                return { x, y };
            };

            bubbleTexts.forEach((text, index) => {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'kitty-bubble';
                    bubble.textContent = text;
                    const { x, y } = getRandomPos();
                    bubble.style.left = `${x}px`;
                    bubble.style.top = `${y}px`;
                    page3.appendChild(bubble);

                    if (index === bubbleTexts.length - 1) {
                        setTimeout(() => {
                            const yearText = document.createElement('div');
                            yearText.className = 'year2026';
                            yearText.textContent = '我们的2026年';
                            page3.appendChild(yearText);
                            setTimeout(() => {
                                music1.pause();
                                page3.classList.add('hidden');
                                page4.classList.remove('hidden');
                                // 播放音乐2（用户交互后触发）
                                music2.play().catch(err => {
                                    alert('请点击屏幕任意位置继续播放音乐~');
                                    music2.play();
                                });
                                initAutoScroll();
                                initScrollParticles();
                            }, 10000); // 与yearGrow动画时长一致
                        }, 800);
                    }
                }, index * 300);
            });
        }

        // 自动缓慢滚动（微信兼容）
        function initAutoScroll() {
            const page4 = document.getElementById('page4');
            let scrollSpeed = 0.2;
            let autoScroll = true;

            const scrollInterval = setInterval(() => {
                if (autoScroll && page4.scrollTop < page4.scrollHeight - page4.clientHeight - 150) {
                    page4.scrollTop += scrollSpeed;
                } else {
                    clearInterval(scrollInterval);
                }
            }, 50);

            page4.addEventListener('touchmove', () => {
                autoScroll = false;
                clearInterval(scrollInterval);
            });
        }

        // 滑动粒子特效
        function initScrollParticles() {
            const page4 = document.getElementById('page4');
            page4.addEventListener('scroll', () => {
                if (Math.random() > 0.8) { // 降低粒子生成频率，微信更流畅
                    const particle = document.createElement('div');
                    particle.className = 'scroll-particle';
                    const size = Math.random() * 5 + 1;
                    const x = Math.random() * page4.clientWidth;
                    const y = page4.scrollTop + page4.clientHeight;
                    const duration = Math.random() * 5 + 2;

                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    particle.style.animation = `scrollFloat ${duration}s linear forwards`;

                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes scrollFloat {
                            0% { transform: translateY(0); opacity: 1; }
                            100% { transform: translateY(-80px); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    page4.appendChild(particle);
                    setTimeout(() => particle.remove(), duration * 1000);
                }
            });
        }

        // 跳转画面5
        function goToPage5() {
            music2.pause();
            page4.classList.add('hidden');
            page5.classList.remove('hidden');
            fireworkSound.play().catch(err => {
                fireworkSound.play();
            });
            createFireworks();
            createMeteors();
            createGiftParticles(page5, 150);
        }

        // 多色烟花（微信兼容）
        function createFireworks() {
            const page5 = document.getElementById('page5');
            const fireworkCount = 20;
            const colors = ['#ff69b4', '#ffb6c1', '#ffffff', '#ff4500', '#ffff00', '#00ff00', '#00ffff', '#9932cc', '#ff00ff', '#1e90ff'];

            for (let i = 0; i < fireworkCount; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    const x = Math.random() * page5.clientWidth;
                    const y = Math.random() * page5.clientHeight;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const size = Math.random() * 120 + 40;

                    firework.style.left = `${x}px`;
                    firework.style.top = `${y}px`;
                    firework.style.width = `${size}px`;
                    firework.style.height = `${size}px`;
                    firework.style.border = `2px solid ${color}`;
                    firework.style.borderRadius = '50%';
                    firework.style.animation = `fireworkPop 2s ease forwards`;

                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes fireworkPop {
                            0% { transform: scale(0); opacity: 1; }
                            50% { transform: scale(1); opacity: 1; box-shadow: 0 0 25px ${color}; }
                            100% { transform: scale(0); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    page5.appendChild(firework);
                    setTimeout(() => firework.remove(), 2000);
                }, i * 400);
            }
        }

        // 流星雨
        function createMeteors() {
            const page5 = document.getElementById('page5');
            const meteorCount = 40;

            for (let i = 0; i < meteorCount; i++) {
                setTimeout(() => {
                    const meteor = document.createElement('div');
                    meteor.className = 'meteor';
                    const x = Math.random() * page5.clientWidth;
                    const y = Math.random() * page5.clientHeight;
                    const rotate = Math.random() * 30 + 60;

                    meteor.style.left = `${x}px`;
                    meteor.style.top = `${y}px`;
                    meteor.style.transform = `rotate(${rotate}deg)`;
                    meteor.style.animation = `meteorFly 3s linear forwards`;

                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes meteorFly {
                            0% { transform: rotate(${rotate}deg) translateX(0); opacity: 1; }
                            100% { transform: rotate(${rotate}deg) translateX(-180px); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    page5.appendChild(meteor);
                    setTimeout(() => meteor.remove(), 3000);
                }, i * 200);
            }
        }

        // 礼物粒子
        function createGiftParticles(container, count) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'gift-particle';
                const size = Math.random() * 5 + 1;
                const x = Math.random() * container.clientWidth;
                const y = Math.random() * container.clientHeight;
                const duration = Math.random() * 7 + 3;

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.animation = `giftFloat ${duration}s linear infinite`;

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes giftFloat {
                        0% { transform: translateY(0) translateX(0); opacity: 1; }
                        25% { transform: translateY(-12px) translateX(8px); opacity: 0.8; }
                        50% { transform: translateY(-25px) translateX(0); opacity: 1; }
                        75% { transform: translateY(-12px) translateX(-8px); opacity: 0.8; }
                        100% { transform: translateY(0) translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                container.appendChild(particle);
            }
        }
    </script>
</body>
</html>
